common:
  default_n_jobs: 4
  chunksize: 200000

steps:
  - type: remove_duplicates
    parameters:
      inputs:  [News-Commentary.en-zh.en, News-Commentary.en-zh.zh]
      outputs: [news.dedup.en, news.dedup.zh]


  - type: preprocess
    parameters:
      inputs:  [news.dedup.en, news.dedup.zh]
      outputs: [news.pre.en,  news.pre.zh]
      preprocessors:
        - RegExpSub:
            patterns:
               - ['&quot;', '"', 0, []]
               - ['&#34;',  '"', 0, []]
               - ['&amp;',  '&', 0, []]
               - ['&lt;',   '<', 0, []]
               - ['&gt;',   '>', 0, []]
               - ['&#39;|&apos;', "'", 0, []]

               - ['\\b(?:https?://|www\\.)\\S+', ' ', 0, ["I"]]
               - ['\\b[\\w.+-]+@[\\w.-]+\\.[A-Za-z]{2,}\\b', ' ', 0, ["I"]]

        - WhitespaceNormalizer: {}

  - type: filter
    parameters:
      inputs: [news.pre.en, news.pre.zh]
      outputs: [news.clean.en, news.clean.zh]
      filters:
        - LengthFilter:
            min_length: [5, 5]
            max_length: [200, 400]
            unit: [word, char]   
        - LengthRatioFilter:
            threshold: 5.0
            unit: char           
        - CharacterScoreFilter:
            scripts: [Latin, Han]
            thresholds: [0.80, 0.60]  
        - HtmlTagFilter: {}           
        - TerminalPunctuationFilter:
            threshold: -2             
        - NonZeroNumeralsFilter:
            threshold: 0.5          
        - RepetitionFilter:
            threshold: 2
            min_length: 6
            max_length: 80            
        - LangidFilter:
            languages: [en, zh]
            thresholds: [0.80, 0.80] 
            langid_languages: [en, zh]
